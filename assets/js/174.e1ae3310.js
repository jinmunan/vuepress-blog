(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{505:function(a,s,t){"use strict";t.r(s);var n=t(3),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"nacos简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos简介"}},[a._v("#")]),a._v(" Nacos简介")]),a._v(" "),s("h2",{attrs:{id:"为什么叫nacos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么叫nacos"}},[a._v("#")]),a._v(" 为什么叫Nacos")]),a._v(" "),s("p",[a._v("前四个字母分别为Naming和Configuration的前两个字母，最后的s为Service。")]),a._v(" "),s("h2",{attrs:{id:"是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#是什么"}},[a._v("#")]),a._v(" 是什么")]),a._v(" "),s("ul",[s("li",[a._v("一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。")]),a._v(" "),s("li",[a._v("Nacos: Dynamic Naming and Configuration Service")]),a._v(" "),s("li",[a._v("Nacos就是注册中心＋配置中心的组合 -> Nacos = Eureka+Config+Bus")])]),a._v(" "),s("h2",{attrs:{id:"能干嘛"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#能干嘛"}},[a._v("#")]),a._v(" 能干嘛")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("替代Eureka做服务注册中心")])]),a._v(" "),s("li",[s("p",[a._v("替代Config做服务配置中心")])])]),a._v(" "),s("h2",{attrs:{id:"去哪下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#去哪下载"}},[a._v("#")]),a._v(" 去哪下载")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("Nacos下载地址"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://nacos.io/zh-cn/",target:"_blank",rel:"noopener noreferrer"}},[a._v("官网中文文档"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"各注册中心比较"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#各注册中心比较"}},[a._v("#")]),a._v(" 各注册中心比较")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("服务注册与发现框架")]),a._v(" "),s("th",[a._v("CAP模型")]),a._v(" "),s("th",[a._v("控制台管理")]),a._v(" "),s("th",[a._v("社区活跃度")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("Eureka")]),a._v(" "),s("td",[a._v("AP")]),a._v(" "),s("td",[a._v("支持")]),a._v(" "),s("td",[a._v("低(2.x版本闭源)")])]),a._v(" "),s("tr",[s("td",[a._v("Zookeeper")]),a._v(" "),s("td",[a._v("CP")]),a._v(" "),s("td",[a._v("不支持")]),a._v(" "),s("td",[a._v("中")])]),a._v(" "),s("tr",[s("td",[a._v("consul")]),a._v(" "),s("td",[a._v("CP")]),a._v(" "),s("td",[a._v("支持")]),a._v(" "),s("td",[a._v("高")])]),a._v(" "),s("tr",[s("td",[a._v("Nacos")]),a._v(" "),s("td",[a._v("AP")]),a._v(" "),s("td",[a._v("支持")]),a._v(" "),s("td",[a._v("高")])])])]),a._v(" "),s("h1",{attrs:{id:"nacos安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos安装"}},[a._v("#")]),a._v(" Nacos安装")]),a._v(" "),s("h2",{attrs:{id:"环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[a._v("#")]),a._v(" 环境")]),a._v(" "),s("ul",[s("li",[a._v("本地Java8+Maven环境")]),a._v(" "),s("li",[a._v("从"),s("a",{attrs:{href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("Nacos官网"),s("OutboundLink")],1),a._v("下载Nacos")]),a._v(" "),s("li",[a._v("解压安装包，直接运行bin目录下的"),s("strong",[a._v("startup.cmd")])]),a._v(" "),s("li",[a._v("命令运行成功后直接访问http://localhost:8848/nacos，默认账号密码都是nacos")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221024152450740.png",alt:"image-20221024152450740"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221024152523576.png",alt:"image-20221024152523576"}})]),a._v(" "),s("h1",{attrs:{id:"nacos作为服务注册中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos作为服务注册中心"}},[a._v("#")]),a._v(" Nacos作为服务注册中心")]),a._v(" "),s("h2",{attrs:{id:"搭建服务端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建服务端"}},[a._v("#")]),a._v(" 搭建服务端")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("新建"),s("code",[a._v("cloudalibaba-nacos-provider-payment9001")]),a._v("模块")])]),a._v(" "),s("li",[s("p",[a._v("引入相关POM依赖")])]),a._v(" "),s("li",[s("p",[a._v("将模块注册到Nacos")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("payment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("provider\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置Nacos地址")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("配置主启动类")])]),a._v(" "),s("li",[s("p",[a._v("编写业务类")])]),a._v(" "),s("li",[s("p",[a._v("测试 "),s("a",{attrs:{href:"http://localhost:9001/payment/nacos/1",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:9001/payment/nacos/1"),s("OutboundLink")],1),a._v("，返回结果"),s("code",[a._v("nacos registry, serverPort: 9001 id1")])])]),a._v(" "),s("li",[s("p",[a._v("新建"),s("code",[a._v("cloudalibaba-nacos-provider-payment9002")]),a._v("模块做负载均衡测试")])])]),a._v(" "),s("h2",{attrs:{id:"搭建客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建客户端"}},[a._v("#")]),a._v(" 搭建客户端")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("新建"),s("code",[a._v("cloudalibaba-nacos-consumer-order83")]),a._v("模块")])]),a._v(" "),s("li",[s("p",[a._v("引入相关POM依赖")])]),a._v(" "),s("li",[s("p",[a._v("为什么nacos支持负载均衡？因为spring-cloud-starter-alibaba-nacos-discovery内含netflix-ribbon")])]),a._v(" "),s("li",[s("p",[a._v("将模块注册到Nacos")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("order\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置Nacos地址")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("配置主启动类")])]),a._v(" "),s("li",[s("p",[a._v("配置负载均衡")])]),a._v(" "),s("li",[s("p",[a._v("编写业务类")])]),a._v(" "),s("li",[s("p",[a._v("测试 "),s("a",{attrs:{href:"http://localhost:83/consumer/payment/nacos/1",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:83/consumer/payment/nacos/1"),s("OutboundLink")],1),a._v("，交替返回结果"),s("code",[a._v("nacos registry, serverPort: 9001 id1")]),a._v("、"),s("code",[a._v("nacos registry, serverPort: 9002 id1")])])])]),a._v(" "),s("h2",{attrs:{id:"nacos服务注册中心对比提升"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos服务注册中心对比提升"}},[a._v("#")]),a._v(" Nacos服务注册中心对比提升")]),a._v(" "),s("h3",{attrs:{id:"nacos全景图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos全景图"}},[a._v("#")]),a._v(" Nacos全景图")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221024212424695.png",alt:"image-20221024212424695"}})]),a._v(" "),s("h3",{attrs:{id:"nacos和cap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos和cap"}},[a._v("#")]),a._v(" Nacos和CAP")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221024212500918.png",alt:"image-20221024212500918"}})]),a._v(" "),s("h3",{attrs:{id:"nacos服务发现实例模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos服务发现实例模型"}},[a._v("#")]),a._v(" Nacos服务发现实例模型")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221024212539717.png",alt:"image-20221024212539717"}})]),a._v(" "),s("h3",{attrs:{id:"nacos支持ap和cp模式的切换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos支持ap和cp模式的切换"}},[a._v("#")]),a._v(" Nacos支持AP和CP模式的切换")]),a._v(" "),s("p",[a._v("C是所有节点在同一时间看到的数据是一致的；而A的定义是所有的请求都会收到响应。")]),a._v(" "),s("p",[s("strong",[a._v("何时选择使用何种模式?")])]),a._v(" "),s("p",[a._v("—般来说，如果不需要存储服务级别的信息且服务实例是通过nacos-client注册，并能够保持心跳上报，那么就可以选择AP模式。当前主流的服务如Spring cloud和Dubbo服务，都适用于AP模式，AP模式为了服务的可能性而减弱了一致性，因此AP模式下只支持注册临时实例。")]),a._v(" "),s("p",[a._v("如果需要在服务级别编辑或者存储配置信息，那么CP是必须，K8S服务和DNS服务则适用于CP模式。CP模式下则支持注册持久化实例，此时则是以Raft协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不存在，则会返回错误。")]),a._v(" "),s("p",[a._v("切换命令：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" PUT '"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$NACOS_SERVER")]),a._v(":8848/nacos/v1/ns/operator/switches?entry"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("serverMode"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("value")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("CP\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h1",{attrs:{id:"nacos作为服务配置中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos作为服务配置中心"}},[a._v("#")]),a._v(" Nacos作为服务配置中心")]),a._v(" "),s("h2",{attrs:{id:"搭建客户端-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建客户端-2"}},[a._v("#")]),a._v(" 搭建客户端")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("新建"),s("code",[a._v("cloudalibaba-nacos-config-client3377")]),a._v("模块")])]),a._v(" "),s("li",[s("p",[a._v("引入相关POM依赖")])]),a._v(" "),s("li",[s("p",[a._v("springboot中配置文件的加载是存在优先级顺序的，bootstrap优先级高于application")])]),a._v(" "),s("li",[s("p",[a._v("bootstrap.yml")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("client\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Nacos服务注册中心地址")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Nacos作为配置中心地址")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file-extension")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yaml "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 读指定yaml格式的配置")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("application.yml")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("profiles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("active")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 表示开发环境")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#active: test # 表示测试环境")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("配置主启动类")])]),a._v(" "),s("li",[s("p",[a._v("编写业务类")])])]),a._v(" "),s("h2",{attrs:{id:"dataid配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dataid配置"}},[a._v("#")]),a._v(" DataID配置")]),a._v(" "),s("h3",{attrs:{id:"配置规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置规则"}},[a._v("#")]),a._v(" 配置规则")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Nacos官方文档"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("Nacos中的datald的组成格式及与SpringBoot配置文件中的匹配规则如下：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("${prefix}-${spring-profile.active}.${file-extension}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("prefix默认为spring.application.name的值，也可以通过配置项spring.cloud.nacos.config.prefix来配置。")]),a._v(" "),s("li",[a._v("spring.profile.active即为当前环境对应的profile，注意：当spring.profile.active为空时，对应的连接符 - 也将不存在，datald 的拼接格式变成${prefix}.${file-extension}")]),a._v(" "),s("li",[a._v("file-exetension为配置内容的数据格式，可以通过配置项spring.cloud.nacos.config.file-extension来配置。"),s("strong",[a._v("目前只支持properties和yaml类型")]),a._v("。")]),a._v(" "),s("li",[a._v("通过Spring Cloud原生注解@RefreshScope实现配置自动更新。")])]),a._v(" "),s("p",[a._v("最后公式：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("${spring.application.name)}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"在nacos中添加配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在nacos中添加配置"}},[a._v("#")]),a._v(" 在Nacos中添加配置")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025104212031.png",alt:"image-20221025104212031"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025104332834.png",alt:"image-20221025104332834"}})]),a._v(" "),s("h4",{attrs:{id:"特别注意"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特别注意"}},[a._v("#")]),a._v(" 特别注意")]),a._v(" "),s("p",[a._v('Data ID 的命名要注意"-"和"."，配置文件的":"是英文格式且保持一个空格。')]),a._v(" "),s("h3",{attrs:{id:"在配置文件中添加配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在配置文件中添加配置"}},[a._v("#")]),a._v(" 在配置文件中添加配置")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025104937682.png",alt:"image-20221025104937682"}})]),a._v(" "),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("启动前需要在nacos客户端-配置管理-配置管理栏目下有对应的yaml配置文件")])]),a._v(" "),s("li",[s("p",[a._v("运行cloudalibaba-nacos-config-client3377的主启动类")])]),a._v(" "),s("li",[s("p",[a._v("调用接口查看配置信息 "),s("a",{attrs:{href:"http://localhost:3377/config/info",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:3377/config/info"),s("OutboundLink")],1)])])]),a._v(" "),s("h3",{attrs:{id:"自带动态刷新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自带动态刷新"}},[a._v("#")]),a._v(" 自带动态刷新")]),a._v(" "),s("p",[a._v("修改下Nacos中的yaml配置文件，再次调用查看配置的接口，就会发现配置已经刷新。")]),a._v(" "),s("h2",{attrs:{id:"命名空间、分组和dataid三者关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命名空间、分组和dataid三者关系"}},[a._v("#")]),a._v(" 命名空间、分组和DataID三者关系")]),a._v(" "),s("h3",{attrs:{id:"问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[a._v("#")]),a._v(" 问题")]),a._v(" "),s("p",[a._v("一个系统通常会准备dev开发环境、test测试环境、prod生产环境等环境，如何保证指定环境启动时服务能正确读取到Nacos上相应环境的配置文件呢?")]),a._v(" "),s("p",[a._v("一个大型分布式微服务系统会有很多微服务子项目，每个微服务项目又都会有相应的开发环境、测试环境、预发环境、正式环境…那怎么对这些微服务配置进行管理呢?")]),a._v(" "),s("h3",{attrs:{id:"namespace、group、data-ld是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#namespace、group、data-ld是什么"}},[a._v("#")]),a._v(" Namespace、Group、Data lD是什么")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025105724153.png",alt:"image-20221025105724153"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025110513263.png",alt:"image-20221025110513263"}})]),a._v(" "),s("p",[a._v("默认情况：Namespace=public，Group=DEFAULT_GROUP，默认Cluster是DEFAULT")]),a._v(" "),s("ul",[s("li",[a._v("Nacos默认的Namespace是public，Namespace主要用来实现隔离。")]),a._v(" "),s("li",[a._v("比方说我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个Namespace，不同的Namespace之间是隔离的。")]),a._v(" "),s("li",[a._v("Group默认是DEFAULT_GROUP，Group可以把不同的微服务划分到同一个分组里面去")]),a._v(" "),s("li",[a._v("Service就是微服务:一个Service可以包含多个Cluster (集群)，Nacos默认Cluster是DEFAULT，Cluster是对指定微服务的一个虚拟划分。")]),a._v(" "),s("li",[a._v("比方说为了容灾，将Service微服务分别部署在了杭州机房和广州机房，这时就可以给杭州机房的Service微服务起一个集群名称(HZ) ，给广州机房的Service微服务起一个集群名称(GZ)，还可以尽量让同一个机房的微服务互相调用，以提升性能。")]),a._v(" "),s("li",[a._v("最后是Instance，就是微服务的实例。")])]),a._v(" "),s("h2",{attrs:{id:"group分组配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#group分组配置"}},[a._v("#")]),a._v(" Group分组配置")]),a._v(" "),s("h3",{attrs:{id:"nacos配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置"}},[a._v("#")]),a._v(" Nacos配置")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025112500781.png",alt:"image-20221025112500781"}})]),a._v(" "),s("h3",{attrs:{id:"yml配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yml配置"}},[a._v("#")]),a._v(" yml配置")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("client\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Nacos服务注册中心地址")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Nacos作为配置中心地址")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file-extension")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yaml "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 读指定yaml格式的配置")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定分组类别")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" TEST_GROUP\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# namespace: 02e22ead-3a6d-420b-999e-cbe5954c2966 # dev")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 116eab8f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("d505"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("49ff"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("8498"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("a231ea865dea "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("h2",{attrs:{id:"namespace空间配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#namespace空间配置"}},[a._v("#")]),a._v(" Namespace空间配置")]),a._v(" "),s("h3",{attrs:{id:"nacos配置-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置-2"}},[a._v("#")]),a._v(" Nacos配置")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025111912760.png",alt:"image-20221025111912760"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.staticaly.com/gh/jinmunan/imgs@master/frame/springcloudalibaba/nacos/image-20221025112249270.png",alt:"image-20221025112249270"}})]),a._v(" "),s("h3",{attrs:{id:"yml配置-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yml配置-2"}},[a._v("#")]),a._v(" yml配置")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("client\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Nacos服务注册中心地址")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Nacos作为配置中心地址")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file-extension")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yaml "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 读指定yaml格式的配置")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" TEST_GROUP\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定namespace命名空间")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# namespace: 02e22ead-3a6d-420b-999e-cbe5954c2966 # dev")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 116eab8f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("d505"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("49ff"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("8498"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("a231ea865dea "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# test")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("h1",{attrs:{id:"nacos集群和持久化配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos集群和持久化配置"}},[a._v("#")]),a._v(" Nacos集群和持久化配置")])])}),[],!1,null,null,null);s.default=e.exports}}]);